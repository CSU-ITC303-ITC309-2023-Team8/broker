version: '3.1'

services:

  mq:
    ports:
      - "0.0.0.0:15672:15672"

  ttn_decoder:
    ports:
      - "127.0.0.1:3001:3001"

  restapi:
    ports:
      - "127.0.0.1:5686:5687"

  ttn_webhook:
    ports:
      - "0.0.0.0:5688:5688"

  website:
    ports:
      - "127.0.0.1:5000:5000"

  x:
    image: broker/python-base
    restart: "no"
    env_file:
      - .env
    environment:
      - PYTHONPATH=/home/broker/broker/src/python:/home/broker/broker/test/python
    depends_on:
      - "db"
      - "mq"
    volumes:
      - ..:/home/broker/broker
    working_dir: "/home/broker/broker"
    entrypoint: [ "./forever.sh" ]
