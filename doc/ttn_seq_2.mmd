sequenceDiagram
    autonumber
    participant MQp as MQ[physical_timeseries]
    participant DM as Device Mapper
    participant DB
    participant MQl as MQ[logical_timeseries]
    MQp-)DM: {physical device id, timestamp, data points}
    DM->>DB: get mapping for physical device id
    DB-->>DM: {physical device, logical device}
    DM-)MQl: {physical device id, logical device id, timestamp, data points}
    MQl->>MQl: persist message
    DM--)MQp: {ack}
    MQl--)DM: {ack} IGNORED
    MQp->>MQp: delete persisted message
    MQl-)Ubidots Writer: {physical device id, logical device id, timestamp, data points}
    Ubidots Writer->>DB: get logical device
    DB-->>Ubidots Writer: logical device
    Ubidots Writer->>Ubidots: POST timeseries to device
    Ubidots Writer--)MQl: {ack}
    MQl->>MQl: delete persisted message
